!function(){function e(e,t){e.appendChild(t)}function t(e){return parseInt(e,10)}function n(e){var n=t(e);return n===e&&!isNaN(n)&&n>=0&&6>=n}function r(e){return e instanceof Date&&!!e.getTime&&!isNaN(e.getTime())}function o(e){return e&&e.isArray?e.isArray():"[object Array]"===Object.prototype.toString.call(e)}function i(e){var t=e.split("."),n=t.shift(),r=document.createElement(n);return r[z]=t.join(" "),r}function a(e){if(e.getBoundingClientRect){var t=document.documentElement.scrollLeft||document.body.scrollLeft||0;return e.getBoundingClientRect().left+t}return e.offsetParent?a(e.offsetParent)+e.offsetLeft:e.offsetLeft}function s(e){if(e.getBoundingClientRect){var t=document.documentElement.scrollTop||document.body.scrollTop||0;return e.getBoundingClientRect().top+t}return e.offsetParent?s(e.offsetParent)+e.offsetTop:e.offsetTop}function u(e){var t={top:s(e),left:a(e),width:e.offsetWidth,height:e.offsetHeight};return t.right=t.left+t.width,t.bottom=t.top+t.height,t}function c(e,t){xtag.addClass(e,t)}function l(e,t){xtag.removeClass(e,t)}function d(e,t){return xtag.hasClass(e,t)}function f(e){return e.getUTCFullYear()}function h(e){return e.getUTCMonth()}function p(e){return e.getUTCDate()}function v(e,t){var n=e.toString(),r=new Array(t).join("0");return(r+n).substr(-t)}function m(e){return[v(f(e),4),v(h(e)+1,2),v(p(e),2)].join("-")}function g(e){if(r(e))return e;var t=J.exec(e);return t?new Date(t[1],t[2]-1,t[3]):null}function b(e){if(r(e))return e;var t=g(e);if(t)return t;var n=Date.parse(e);return isNaN(n)?null:new Date(n)}function y(e){var t;if(o(e))t=e.slice(0);else{if(r(e))return[e];if(!("string"==typeof e&&e.length>0))return null;try{if(t=JSON.parse(e),!o(t))return console.log("invalid list of ranges",e),null}catch(n){var i=b(e);return i?[i]:(console.log("unable to parse",e,"as JSON or single date"),null)}}for(var a=0;a<t.length;a++){var s=t[a];if(!r(s))if("string"==typeof s){var u=b(s);if(!u)return console.log("unable to parse date",s),null;t[a]=u}else{if(!o(s)||2!==s.length)return console.log("invalid range value: ",s),null;var c=b(s[0]);if(!c)return console.log("unable to parse start date",s[0],"from range",s),null;var l=b(s[1]);if(!l)return console.log("unable to parse end date",s[1],"from range",s),null;if(c.valueOf()>l.valueOf())return console.log("invalid range",s,": start date is after end date"),null;t[a]=[c,l]}}return t}function _(e,t,n,r){return void 0===t&&(t=f(e)),void 0===n&&(n=h(e)),void 0===r&&(r=p(e)),new Date(t,n,r)}function w(e,t,n,r){return _(e,f(e)+t,h(e)+n,p(e)+r)}function E(e,r){for(r=t(r),n(r)||(r=0);e.getUTCDay()!==r;)e=T(e);return e}function x(e,r){for(r=t(r),n(r)||(r=6);e.getUTCDay()!==r;)e=A(e);return e}function O(e){for(;p(e)>1;)e=T(e);return e}function N(e){return T(w(e,0,1,0))}function A(e){return w(e,0,0,1)}function T(e){return w(e,0,0,-1)}function C(e,t){if(t){t=void 0===t.length?[t]:t;var n=!1;return t.forEach(function(t){2===t.length?L(t[0],t[1],e)&&(n=!0):m(t)===m(e)&&(n=!0)}),n}}function L(e,t,n){return m(e)<=m(n)&&m(n)<=m(t)}function M(e){e.sort(function(e,t){var n=r(e)?e:e[0],o=r(t)?t:t[0];return n.valueOf()-o.valueOf()})}function k(t){var n=i("div.controls"),r=i("span.prev"),o=i("span.next");return r.innerHTML=t.prev,o.innerHTML=t.next,e(n,r),e(n,o),n}function S(e){e=e||{},this._span=e.span||1,this._multiple=e.multiple||!1,this._viewDate=this._getSanitizedViewDate(e.view,e.chosen),this._chosenRanges=this._getSanitizedChosenRanges(e.chosen,e.view),this._firstWeekdayNum=e.firstWeekdayNum||0,this._el=i("div.calendar"),this._labels=H(),this._customRenderFn=null,this._renderRecursionFlag=!1,this.render(!0)}function D(e){e=e.slice(0),M(e);for(var t=[],n=0;n<e.length;n++){var o,i,a,s,u=e[n],c=t.length>0?t[t.length-1]:null;if(r(u)?o=i=u:(o=u[0],i=u[1]),u=C(o,i)?o:[o,i],r(c))a=s=c;else{if(!c){t.push(u);continue}a=c[0],s=c[1]}if(C(o,[c])||C(T(o),[c])){var l=a.valueOf()<o.valueOf()?a:o,d=s.valueOf()>i.valueOf()?s:i,f=C(l,d)?l:[l,d];t[t.length-1]=f}else t.push(u)}return t}function j(e,t){var n,r=t.getAttribute("data-date"),o=b(r);d(t,W)?(e.xtag.dragType=V,n="datetoggleoff"):(e.xtag.dragType=q,n="datetoggleon"),e.xtag.dragStartEl=t,e.xtag.dragAllowTap=!0,e.disableUIToggle||xtag.fireEvent(e,n,{detail:{date:o,iso:r}}),e.setAttribute("active",!0),t.setAttribute("active",!0)}function R(e,t){var n=t.getAttribute("data-date"),r=b(n);t!==e.xtag.dragStartEl&&(e.xtag.dragAllowTap=!1),e.disableUIToggle||(e.xtag.dragType!==q||d(t,W)?e.xtag.dragType===V&&d(t,W)&&xtag.fireEvent(e,"datetoggleoff",{detail:{date:r,iso:n}}):xtag.fireEvent(e,"datetoggleon",{detail:{date:r,iso:n}})),e.xtag.dragType&&t.setAttribute("active",!0)}function U(){for(var e=xtag.query(document,"x-calendar"),t=0;t<e.length;t++){var n=e[t];n.xtag.dragType=null,n.xtag.dragStartEl=null,n.xtag.dragAllowTap=!1,n.removeAttribute("active")}for(var r=xtag.query(document,"x-calendar .day[active]"),o=0;o<r.length;o++)r[o].removeAttribute("active")}function F(e,t,n){return n.left<=e&&e<=n.right&&n.top<=t&&t<=n.bottom}var P=0,H=function(){return{prev:"<",next:">",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}},I=new Date;I.setUTCHours(0),I.setUTCMinutes(0),I.setUTCSeconds(0),I.setUTCMilliseconds(0);var q="add",V="remove",W="chosen",z="className",J=/(\d{4})[^\d]?(\d{2})[^\d]?(\d{2})/;S.prototype.makeMonth=function(t){if(!r(t))throw"Invalid view date!";var n=this.firstWeekdayNum,o=this.chosen,a=this.labels,s=h(t),u=E(O(t),n),l=i("div.month"),d=i("div.month-label");d.textContent=a.months[s]+" "+f(t),e(l,d);for(var v=i("div.weekday-labels"),g=0;7>g;g++){var b=(n+g)%7,y=i("span.weekday-label");y.textContent=a.weekdays[b],e(v,y)}e(l,v);for(var _=i("div.week"),w=u,x=!1;!x;){var N=i("span.day");N.setAttribute("data-date",m(w)),N.textContent=p(w),h(w)!==s&&c(N,"badmonth"),C(w,o)&&c(N,W),C(w,I)&&c(N,"today"),e(_,N),w=A(w),w.getUTCDay()===n&&(e(l,_),_=i("div.week"),x=h(w)>s||h(w)<s&&f(w)>f(u))}return l},S.prototype._getSanitizedViewDate=function(e,t){if(t=void 0===t?this.chosen:t,r(e))return e;if(r(t))return t;if(o(t)&&t.length>0){var n=t[0];return r(n)?n:n[0]}return I},S.prototype._getSanitizedChosenRanges=function(e,t){t=void 0===t?this.view:t;var n;n=r(e)?[e]:o(e)?e:null!==e&&void 0!==e&&t?[t]:[];var i=D(n);if(!this.multiple&&i.length>0){var a=i[0];return r(a)?[a]:[a[0]]}return i},S.prototype.addDate=function(e,t){r(e)&&(t?(this.chosen.push(e),this.chosen=this.chosen):this.chosen=[e])},S.prototype.removeDate=function(e){if(r(e))for(var t=this.chosen.slice(0),n=0;n<t.length;n++){var i=t[n];if(C(e,[i])){if(t.splice(n,1),o(i)){var a=i[0],s=i[1],u=T(e),c=A(e);C(u,[i])&&t.push([a,u]),C(c,[i])&&t.push([c,s])}this.chosen=D(t);break}}},S.prototype.hasChosenDate=function(e){return C(e,this._chosenRanges)},S.prototype.hasVisibleDate=function(e,t){var n=this.firstVisibleMonth;t||(n=E(n,this.firstWeekdayNum));var r=N(this.lastVisibleMonth);return t||(r=x(r,this.lastWeekdayNum)),C(e,[[n,r]])},S.prototype.render=function(t){var n,r=this._span;if(t){var o,i=xtag.query(this.el,".day");for(n=0;n<i.length;n++)if(o=i[n],o.hasAttribute("data-date")){var a=o.getAttribute("data-date"),s=g(a);s&&(C(s,this._chosenRanges)?c(o,W):l(o,W),C(s,[I])?c(o,"today"):l(o,"today"))}}else{this.el.innerHTML="";var u=this.firstVisibleMonth;for(n=0;r>n;n++)e(this.el,this.makeMonth(u)),u=w(u,0,1,0)}this._callCustomRenderer()},S.prototype._callCustomRenderer=function(){if(this._customRenderFn){if(this._renderRecursionFlag)throw"Error: customRenderFn causes recursive loop of rendering calendar; make sure your custom rendering function doesn't modify attributes of the x-calendar that would require a re-render!";for(var e=xtag.query(this.el,".day"),t=0;t<e.length;t++){var n=e[t],r=n.getAttribute("data-date"),o=g(r);this._renderRecursionFlag=!0,this._customRenderFn(n,o?o:null,r),this._renderRecursionFlag=!1}}},Object.defineProperties(S.prototype,{el:{get:function(){return this._el}},multiple:{get:function(){return this._multiple},set:function(e){this._multiple=e,this.chosen=this._getSanitizedChosenRanges(this.chosen),this.render(!0)}},span:{get:function(){return this._span},set:function(e){var n=t(e);this._span=!isNaN(n)&&n>=0?n:0,this.render(!1)}},view:{attribute:{},get:function(){return this._viewDate},set:function(e){var t=this._getSanitizedViewDate(e),n=this._viewDate;this._viewDate=t,this.render(h(n)===h(t)&&f(n)===f(t))}},chosen:{get:function(){return this._chosenRanges},set:function(e){this._chosenRanges=this._getSanitizedChosenRanges(e),this.render(!0)}},firstWeekdayNum:{get:function(){return this._firstWeekdayNum},set:function(e){e=t(e),n(e)||(e=0),this._firstWeekdayNum=e,this.render(!1)}},lastWeekdayNum:{get:function(){return(this._firstWeekdayNum+6)%7}},customRenderFn:{get:function(){return this._customRenderFn},set:function(e){this._customRenderFn=e,this.render(!0)}},chosenString:{get:function(){if(this.multiple){for(var e=this.chosen.slice(0),t=0;t<e.length;t++){var n=e[t];e[t]=r(n)?m(n):[m(n[0]),m(n[1])]}return JSON.stringify(e)}return this.chosen.length>0?m(this.chosen[0]):""}},firstVisibleMonth:{get:function(){return O(w(this.view,0,-Math.floor(this.span/2),0))}},lastVisibleMonth:{get:function(){return w(this.firstVisibleMonth,0,Math.max(0,this.span-1),0)}},labels:{get:function(){return this._labels},set:function(e){var t=this.labels;for(var n in t)if(n in e){var r=this._labels[n],i=e[n];if(o(r)){if(!o(i)||r.length!==i.length)throw"invalid label given for '"+n+"': expected array of "+r.length+" labels, got "+JSON.stringify(i);i=i.slice(0);for(var a=0;a<i.length;a++)i[a]=i[a].toString?i[a].toString():String(i[a])}else i=String(i);t[n]=i}this.render(!1)}}});var B=null,G=null;xtag.register("x-calendar",{lifecycle:{created:function(){this.innerHTML="";var t=this.getAttribute("chosen");this.xtag.calObj=new S({span:this.getAttribute("span"),view:b(this.getAttribute("view")),chosen:y(t),multiple:this.hasAttribute("multiple"),firstWeekdayNum:this.getAttribute("first-weekday-num")}),e(this,this.xtag.calObj.el),this.xtag.calControls=null,this.xtag.dragType=null,this.xtag.dragStartEl=null,this.xtag.dragAllowTap=!1},inserted:function(){B||(B=xtag.addEvent(document,"mouseup",U)),G||(G=xtag.addEvent(document,"touchend",U)),this.render(!1)},removed:function(){0===xtag.query(document,"x-calendar").length&&(B&&(xtag.removeEvent(document,"mouseup",B),B=null),G&&(xtag.removeEvent(document,"touchend",G),G=null))}},events:{"tap:delegate(.next)":function(e){var t=e.currentTarget;t.nextMonth(),xtag.fireEvent(t,"nextmonth")},"tap:delegate(.prev)":function(e){var t=e.currentTarget;t.prevMonth(),xtag.fireEvent(t,"prevmonth")},"tapstart:delegate(.day)":function(e){(e.touches||!e.button||e.button===P)&&(e.preventDefault(),j(e.currentTarget,this))},touchmove:function(e){if(e.touches&&e.touches.length>0){var t=e.currentTarget;if(t.xtag.dragType)for(var n=e.touches[0],r=xtag.query(t,".day"),o=0;o<r.length;o++){var i=r[o];F(n.pageX,n.pageY,u(i))?R(t,i):i.removeAttribute("active")}}},"mouseover:delegate(.day)":function(e){var t=e.currentTarget,n=this;R(t,n)},"mouseout:delegate(.day)":function(){var e=this;e.removeAttribute("active")},"tapend:delegate(.day)":function(e){var t=e.currentTarget;if(t.xtag.dragAllowTap){var n=this,r=n.getAttribute("data-date"),o=b(r);xtag.fireEvent(t,"datetap",{detail:{date:o,iso:r}})}},datetoggleon:function(e){var t=this;t.toggleDateOn(e.detail.date,t.multiple)},datetoggleoff:function(e){var t=this;t.toggleDateOff(e.detail.date)}},accessors:{controls:{attribute:{"boolean":!0},set:function(t){t&&!this.xtag.calControls&&(this.xtag.calControls=k(this.xtag.calObj.labels),e(this,this.xtag.calControls))}},multiple:{attribute:{"boolean":!0},get:function(){return this.xtag.calObj.multiple},set:function(e){this.xtag.calObj.multiple=e,this.chosen=this.chosen}},span:{attribute:{},get:function(){return this.xtag.calObj.span},set:function(e){this.xtag.calObj.span=e}},view:{attribute:{},get:function(){return this.xtag.calObj.view},set:function(e){var t=b(e);t&&(this.xtag.calObj.view=t)}},chosen:{attribute:{skip:!0},get:function(){var e=this.xtag.calObj.chosen;if(this.multiple)return this.xtag.calObj.chosen;if(e.length>0){var t=e[0];return r(t)?t:t[0]}return null},set:function(e){var t=this.multiple?y(e):b(e);this.xtag.calObj.chosen=t?t:null,this.xtag.calObj.chosenString?this.setAttribute("chosen",this.xtag.calObj.chosenString):this.removeAttribute("chosen")}},firstWeekdayNum:{attribute:{name:"first-weekday-num"},set:function(e){this.xtag.calObj.firstWeekdayNum=e}},disableUIToggle:{attribute:{"boolean":!0,name:"disable-ui-toggle"},set:function(e){e&&(this.chosen=null)}},firstVisibleMonth:{get:function(){return this.xtag.calObj.firstVisibleMonth}},lastVisibleMonth:{get:function(){return this.xtag.calObj.lastVisibleMonth}},customRenderFn:{get:function(){return this.xtag.calObj.customRenderFn},set:function(e){this.xtag.calObj.customRenderFn=e}}},methods:{render:function(e){this.xtag.calObj.render(e)},prevMonth:function(){var e=this.xtag.calObj;e.view=w(e.view,0,-1,0)},nextMonth:function(){var e=this.xtag.calObj;e.view=w(e.view,0,1,0)},toggleDateOn:function(e,t){this.xtag.calObj.addDate(e,t),this.chosen=this.chosen},toggleDateOff:function(e){this.xtag.calObj.removeDate(e),this.chosen=this.chosen},toggleDate:function(e,t){this.xtag.calObj.hasChosenDate(e)?this.toggleDateOff(e):this.toggleDateOn(e,t)},hasVisibleDate:function(e,t){return this.xtag.calObj.hasVisibleDate(e,t)},editLabels:function(e){this.xtag.calObj.labels=e;var t=this.xtag.calObj.labels,n=this.querySelector(".controls > .prev");n&&(n.textContent=t.prev);var r=this.querySelector(".controls > .next");r&&(r.textContent=t.next)}}})}();