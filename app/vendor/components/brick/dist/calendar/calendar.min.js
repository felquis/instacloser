!function(){function e(e){if(0===e.getUTCHours()&&0===e.getUTCMinutes()&&0===e.getUTCSeconds()&&0===e.getUTCMilliseconds())return new Date(e.valueOf());var t=new Date;return t.setUTCDate(e.getDate()),t.setUTCMonth(e.getMonth()),t.setUTCFullYear(e.getFullYear()),t.setUTCHours(0),t.setUTCMinutes(0),t.setUTCSeconds(0),t.setUTCMilliseconds(0),t}function t(e,t){e.appendChild(t)}function n(e){return parseInt(e,10)}function r(e){var t=n(e);return t===e&&!isNaN(t)&&t>=0&&6>=t}function o(e){return e instanceof Date&&!!e.getTime&&!isNaN(e.getTime())}function i(e){return e&&e.isArray?e.isArray():"[object Array]"===Object.prototype.toString.call(e)}function a(e){var t=e.split("."),n=t.shift(),r=document.createElement(n);return r[Y]=t.join(" "),r}function s(e){var t=e.getBoundingClientRect(),n=document.documentElement,r=n.scrollTop||document.body.scrollTop||0,o=n.scrollLeft||document.body.scrollLeft||0;return{left:t.left+o,right:t.right+o,top:t.top+r,bottom:t.bottom+r,width:t.width,height:t.height}}function c(e,t){xtag.addClass(e,t)}function u(e,t){xtag.removeClass(e,t)}function l(e,t){return xtag.hasClass(e,t)}function d(e){return e.getUTCFullYear()}function f(e){return e.getUTCMonth()}function h(e){return e.getUTCDate()}function p(e){return e.getUTCDay()}function v(e,t){var n=e.toString(),r=new Array(t).join("0");return(r+n).substr(-t)}function m(e){return[v(d(e),4),v(f(e)+1,2),v(h(e),2)].join("-")}function g(t){if(o(t))return t;var n=z.exec(t);return n?e(new Date(n[1],n[2]-1,n[3])):null}function b(t){if(o(t))return t;var n=g(t);if(n)return n;var r=Date.parse(t);return isNaN(r)?null:e(new Date(r))}function _(e){var t;if(i(e))t=e.slice(0);else{if(o(e))return[e];if(!("string"==typeof e&&e.length>0))return null;try{if(t=JSON.parse(e),!i(t))return console.warn("invalid list of ranges",e),null}catch(n){var r=b(e);return r?[r]:(console.warn("unable to parse",e,"as JSON or single date"),null)}}for(var a=0;a<t.length;a++){var s=t[a];if(!o(s))if("string"==typeof s){var c=b(s);if(!c)return console.warn("unable to parse date",s),null;t[a]=c}else{if(!i(s)||2!==s.length)return console.warn("invalid range value: ",s),null;var u=b(s[0]);if(!u)return console.warn("unable to parse start date",s[0],"from range",s),null;var l=b(s[1]);if(!l)return console.warn("unable to parse end date",s[1],"from range",s),null;if(u.valueOf()>l.valueOf())return console.warn("invalid range",s,": start date is after end date"),null;t[a]=[u,l]}}return t}function y(t,n,r,o){return void 0===n&&(n=d(t)),void 0===r&&(r=f(t)),void 0===o&&(o=h(t)),e(new Date(n,r,o))}function w(e,t,n,r){return y(e,d(e)+t,f(e)+n,h(e)+r)}function E(e,t){t=n(t),r(t)||(t=0);for(var o=0;7>o;o++){if(p(e)===t)return e;e=C(e)}throw"unable to find week start"}function x(e,t){t=n(t),r(t)||(t=6);for(var o=0;7>o;o++){if(p(e)===t)return e;e=T(e)}throw"unable to find week end"}function O(t){return t=new Date(t.valueOf()),t.setUTCDate(1),e(t)}function N(e){return C(w(e,0,1,0))}function T(e){return w(e,0,0,1)}function C(e){return w(e,0,0,-1)}function L(e,t){if(t){t=void 0===t.length?[t]:t;var n=!1;return t.forEach(function(t){2===t.length?A(t[0],t[1],e)&&(n=!0):m(t)===m(e)&&(n=!0)}),n}}function A(e,t,n){return m(e)<=m(n)&&m(n)<=m(t)}function k(e){e.sort(function(e,t){var n=o(e)?e:e[0],r=o(t)?t:t[0];return n.valueOf()-r.valueOf()})}function M(e){var n=a("div.controls"),r=a("span.prev"),o=a("span.next");return r.innerHTML=e.prev,o.innerHTML=e.next,t(n,r),t(n,o),n}function D(e){var t=this;e=e||{},t._span=e.span||1,t._multiple=e.multiple||!1,t._viewDate=t._getSanitizedViewDate(e.view,e.chosen),t._chosenRanges=t._getSanitizedChosenRanges(e.chosen,e.view),t._firstWeekdayNum=e.firstWeekdayNum||0,t._el=a("div.calendar"),t._labels=H(),t._customRenderFn=null,t._renderRecursionFlag=!1,t.render(!0)}function S(e){e=e.slice(0),k(e);for(var t=[],n=0;n<e.length;n++){var r,i,a,s,c=e[n],u=t.length>0?t[t.length-1]:null;if(o(c)?r=i=c:(r=c[0],i=c[1]),c=L(r,i)?r:[r,i],o(u))a=s=u;else{if(!u){t.push(c);continue}a=u[0],s=u[1]}if(L(r,[u])||L(C(r),[u])){var l=a.valueOf()<r.valueOf()?a:r,d=s.valueOf()>i.valueOf()?s:i,f=L(l,d)?l:[l,d];t[t.length-1]=f}else t.push(c)}return t}function j(e,t){var n,r=t.getAttribute("data-date"),o=b(r);l(t,W)?(e.xtag.dragType=q,n="datetoggleoff"):(e.xtag.dragType=V,n="datetoggleon"),e.xtag.dragStartEl=t,e.xtag.dragAllowTap=!0,e.noToggle||xtag.fireEvent(e,n,{detail:{date:o,iso:r}}),e.setAttribute("active",!0),t.setAttribute("active",!0)}function R(e,t){var n=t.getAttribute("data-date"),r=b(n);t!==e.xtag.dragStartEl&&(e.xtag.dragAllowTap=!1),e.noToggle||(e.xtag.dragType!==V||l(t,W)?e.xtag.dragType===q&&l(t,W)&&xtag.fireEvent(e,"datetoggleoff",{detail:{date:r,iso:n}}):xtag.fireEvent(e,"datetoggleon",{detail:{date:r,iso:n}})),e.xtag.dragType&&t.setAttribute("active",!0)}function U(){for(var e=xtag.query(document,"x-calendar"),t=0;t<e.length;t++){var n=e[t];n.xtag.dragType=null,n.xtag.dragStartEl=null,n.xtag.dragAllowTap=!1,n.removeAttribute("active")}for(var r=xtag.query(document,"x-calendar .day[active]"),o=0;o<r.length;o++)r[o].removeAttribute("active")}function F(e,t,n){return n.left<=e&&e<=n.right&&n.top<=t&&t<=n.bottom}var P=0,H=function(){return{prev:"<",next:">",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}},I=e(new Date),V="add",q="remove",W="chosen",Y="className",z=/(\d{4})[^\d]?(\d{2})[^\d]?(\d{2})/,J=D.prototype;J.makeMonth=function(e){if(!o(e))throw"Invalid view date!";var n=this.firstWeekdayNum,r=this.chosen,i=this.labels,s=f(e),u=E(O(e),n),l=a("div.month"),p=a("div.month-label");p.textContent=i.months[s]+" "+d(e),t(l,p);for(var v=a("div.weekday-labels"),g=0;7>g;g++){var b=(n+g)%7,_=a("span.weekday-label");_.textContent=i.weekdays[b],t(v,_)}t(l,v);for(var y=a("div.week"),w=u,x=42,g=0;x>g;g++){var N=a("span.day");if(N.setAttribute("data-date",m(w)),N.textContent=h(w),f(w)!==s&&c(N,"badmonth"),L(w,r)&&c(N,W),L(w,I)&&c(N,"today"),t(y,N),w=T(w),0===(g+1)%7){t(l,y),y=a("div.week");var C=f(w)>s||f(w)<s&&d(w)>d(u);if(C)break}}return l},J._getSanitizedViewDate=function(e,t){t=void 0===t?this.chosen:t;var n;if(o(e))n=e;else if(o(t))n=t;else if(i(t)&&t.length>0){var r=t[0];n=o(r)?r:r[0]}else n=I;return n},J._getSanitizedChosenRanges=function(e,t){t=void 0===t?this.view:t;var n;n=o(e)?[e]:i(e)?e:null!==e&&void 0!==e&&t?[t]:[];var r=S(n);if(!this.multiple&&r.length>0){var a=r[0];return o(a)?[a]:[a[0]]}return r},J.addDate=function(e,t){o(e)&&(t?(this.chosen.push(e),this.chosen=this.chosen):this.chosen=[e])},J.removeDate=function(e){if(o(e))for(var t=this.chosen.slice(0),n=0;n<t.length;n++){var r=t[n];if(L(e,[r])){if(t.splice(n,1),i(r)){var a=r[0],s=r[1],c=C(e),u=T(e);L(c,[r])&&t.push([a,c]),L(u,[r])&&t.push([u,s])}this.chosen=S(t);break}}},J.hasChosenDate=function(e){return L(e,this._chosenRanges)},J.hasVisibleDate=function(e,t){var n=t?this.firstVisibleMonth:this.firstVisibleDate,r=t?N(this.lastVisibleMonth):this.lastVisibleDate;return L(e,[[n,r]])},J.render=function(e){var n,r=this._span;if(e){var o,i=xtag.query(this.el,".day");for(n=0;n<i.length;n++)if(o=i[n],o.hasAttribute("data-date")){var a=o.getAttribute("data-date"),s=g(a);s&&(L(s,this._chosenRanges)?c(o,W):u(o,W),L(s,[I])?c(o,"today"):u(o,"today"))}}else{this.el.innerHTML="";var l=this.firstVisibleMonth;for(n=0;r>n;n++)t(this.el,this.makeMonth(l)),l=w(l,0,1,0)}this._callCustomRenderer()},J._callCustomRenderer=function(){if(this._customRenderFn){if(this._renderRecursionFlag)throw"Error: customRenderFn causes recursive loop of rendering calendar; make sure your custom rendering function doesn't modify attributes of the x-calendar that would require a re-render!";for(var e=xtag.query(this.el,".day"),t=0;t<e.length;t++){var n=e[t],r=n.getAttribute("data-date"),o=g(r);this._renderRecursionFlag=!0,this._customRenderFn(n,o?o:null,r),this._renderRecursionFlag=!1}}},Object.defineProperties(J,{el:{get:function(){return this._el}},multiple:{get:function(){return this._multiple},set:function(e){this._multiple=e,this.chosen=this._getSanitizedChosenRanges(this.chosen),this.render(!0)}},span:{get:function(){return this._span},set:function(e){var t=n(e);this._span=!isNaN(t)&&t>=0?t:0,this.render(!1)}},view:{attribute:{},get:function(){return this._viewDate},set:function(e){var t=this._getSanitizedViewDate(e),n=this._viewDate;this._viewDate=t,this.render(f(n)===f(t)&&d(n)===d(t))}},chosen:{get:function(){return this._chosenRanges},set:function(e){this._chosenRanges=this._getSanitizedChosenRanges(e),this.render(!0)}},firstWeekdayNum:{get:function(){return this._firstWeekdayNum},set:function(e){e=n(e),r(e)||(e=0),this._firstWeekdayNum=e,this.render(!1)}},lastWeekdayNum:{get:function(){return(this._firstWeekdayNum+6)%7}},customRenderFn:{get:function(){return this._customRenderFn},set:function(e){this._customRenderFn=e,this.render(!0)}},chosenString:{get:function(){if(this.multiple){for(var e=this.chosen.slice(0),t=0;t<e.length;t++){var n=e[t];e[t]=o(n)?m(n):[m(n[0]),m(n[1])]}return JSON.stringify(e)}return this.chosen.length>0?m(this.chosen[0]):""}},firstVisibleMonth:{get:function(){return O(w(this.view,0,-Math.floor(this.span/2),0))}},lastVisibleMonth:{get:function(){return w(this.firstVisibleMonth,0,Math.max(0,this.span-1),0)}},firstVisibleDate:{get:function(){return E(this.firstVisibleMonth,this.firstWeekdayNum)}},lastVisibleDate:{get:function(){return x(N(this.lastVisibleMonth),this.lastWeekdayNum)}},labels:{get:function(){return this._labels},set:function(e){var t=this.labels;for(var n in t)if(n in e){var r=this._labels[n],o=e[n];if(i(r)){if(!i(o)||r.length!==o.length)throw"invalid label given for '"+n+"': expected array of "+r.length+" labels, got "+JSON.stringify(o);o=o.slice(0);for(var a=0;a<o.length;a++)o[a]=o[a].toString?o[a].toString():String(o[a])}else o=String(o);t[n]=o}this.render(!1)}}});var X=null,G=null;xtag.register("x-calendar",{lifecycle:{created:function(){this.innerHTML="";var e=this.getAttribute("chosen");this.xtag.calObj=new D({span:this.getAttribute("span"),view:b(this.getAttribute("view")),chosen:_(e),multiple:this.hasAttribute("multiple"),firstWeekdayNum:this.getAttribute("first-weekday-num")}),t(this,this.xtag.calObj.el),this.xtag.calControls=null,this.xtag.dragType=null,this.xtag.dragStartEl=null,this.xtag.dragAllowTap=!1},inserted:function(){X||(X=xtag.addEvent(document,"mouseup",U)),G||(G=xtag.addEvent(document,"touchend",U)),this.render(!1)},removed:function(){0===xtag.query(document,"x-calendar").length&&(X&&(xtag.removeEvent(document,"mouseup",X),X=null),G&&(xtag.removeEvent(document,"touchend",G),G=null))}},events:{"tap:delegate(.next)":function(e){var t=e.currentTarget;t.nextMonth(),xtag.fireEvent(t,"nextmonth")},"tap:delegate(.prev)":function(e){var t=e.currentTarget;t.prevMonth(),xtag.fireEvent(t,"prevmonth")},"tapstart:delegate(.day)":function(e){(e.touches||!e.button||e.button===P)&&(e.preventDefault(),e.baseEvent&&e.baseEvent.preventDefault(),j(e.currentTarget,this))},touchmove:function(e){if(e.touches&&e.touches.length>0){var t=e.currentTarget;if(t.xtag.dragType)for(var n=e.touches[0],r=xtag.query(t,".day"),o=0;o<r.length;o++){var i=r[o];F(n.pageX,n.pageY,s(i))?R(t,i):i.removeAttribute("active")}}},"mouseover:delegate(.day)":function(e){var t=e.currentTarget,n=this;R(t,n)},"mouseout:delegate(.day)":function(){var e=this;e.removeAttribute("active")},"tapend:delegate(.day)":function(e){var t=e.currentTarget;if(t.xtag.dragAllowTap){var n=this,r=n.getAttribute("data-date"),o=b(r);xtag.fireEvent(t,"datetap",{detail:{date:o,iso:r}})}},datetoggleon:function(e){var t=this;t.toggleDateOn(e.detail.date,t.multiple)},datetoggleoff:function(e){var t=this;t.toggleDateOff(e.detail.date)}},accessors:{controls:{attribute:{"boolean":!0},set:function(e){e&&!this.xtag.calControls&&(this.xtag.calControls=M(this.xtag.calObj.labels),t(this,this.xtag.calControls))}},multiple:{attribute:{"boolean":!0},get:function(){return this.xtag.calObj.multiple},set:function(e){this.xtag.calObj.multiple=e,this.chosen=this.chosen}},span:{attribute:{},get:function(){return this.xtag.calObj.span},set:function(e){this.xtag.calObj.span=e}},view:{attribute:{},get:function(){return this.xtag.calObj.view},set:function(e){var t=b(e);t&&(this.xtag.calObj.view=t)}},chosen:{attribute:{skip:!0},get:function(){var e=this.xtag.calObj.chosen;if(this.multiple)return this.xtag.calObj.chosen;if(e.length>0){var t=e[0];return o(t)?t:t[0]}return null},set:function(e){var t=this.multiple?_(e):b(e);this.xtag.calObj.chosen=t?t:null,this.xtag.calObj.chosenString?this.setAttribute("chosen",this.xtag.calObj.chosenString):this.removeAttribute("chosen")}},firstWeekdayNum:{attribute:{name:"first-weekday-num"},set:function(e){this.xtag.calObj.firstWeekdayNum=e}},noToggle:{attribute:{"boolean":!0,name:"notoggle"},set:function(e){e&&(this.chosen=null)}},firstVisibleMonth:{get:function(){return this.xtag.calObj.firstVisibleMonth}},lastVisibleMonth:{get:function(){return this.xtag.calObj.lastVisibleMonth}},firstVisibleDate:{get:function(){return this.xtag.calObj.firstVisibleDate}},lastVisibleDate:{get:function(){return this.xtag.calObj.lastVisibleDate}},customRenderFn:{get:function(){return this.xtag.calObj.customRenderFn},set:function(e){this.xtag.calObj.customRenderFn=e}},labels:{get:function(){return JSON.parse(JSON.stringify(this.xtag.calObj.labels))},set:function(e){this.xtag.calObj.labels=e;var t=this.xtag.calObj.labels,n=this.querySelector(".controls > .prev");n&&(n.textContent=t.prev);var r=this.querySelector(".controls > .next");r&&(r.textContent=t.next)}}},methods:{render:function(e){this.xtag.calObj.render(e)},prevMonth:function(){var e=this.xtag.calObj;e.view=w(e.view,0,-1,0)},nextMonth:function(){var e=this.xtag.calObj;e.view=w(e.view,0,1,0)},toggleDateOn:function(e,t){this.xtag.calObj.addDate(e,t),this.chosen=this.chosen},toggleDateOff:function(e){this.xtag.calObj.removeDate(e),this.chosen=this.chosen},toggleDate:function(e,t){this.xtag.calObj.hasChosenDate(e)?this.toggleDateOff(e):this.toggleDateOn(e,t)},hasVisibleDate:function(e,t){return this.xtag.calObj.hasVisibleDate(e,t)}}})}();